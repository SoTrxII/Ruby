<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: systemCommands/managing/lock.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="styles/prettify-tomorrow.css" rel="stylesheet" type="text/css">
    <link href="styles/jsdoc-default.css" rel="stylesheet" type="text/css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: systemCommands/managing/lock.js</h1>


    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//External Libraries
const Promise = require('bluebird');
const path = require('path');
const {
  saveConfig
} = require()

//Constant
const commands = require(path.join(baseAppDir, 'commands')).commands;

let lock = (evt, command, cmdArg) => {
  return new Promise((resolve, reject) => {
    let subCommand = cmdArg.split(' ')[0].toLowerCase();
    let subParameters = cmdArg.substring(subCommand.length + 1);
    let namesOrIds = subParameters.split(' ');

    if (subCommand === "private") {
      global.Config.Commands.allowPrivate = (command !== 'lock');
    }
    //If the command does not exists
    else if (Object.keys(commands).indexOf(subCommand) !== -1) {
      let denyList = global.Config.Commands.denyList;

      for (let nameOrId of namesOrIds) {
        let member = getMember(evt.guild.members, nameOrId);
        // Si l'id ou le nom donné ne correspond à rien.
        if (!member) {
          evt.reply(`${nameOrId} n'est pas un identifiant valide, admin`).then(() => {
            reject("Member does not exists");
          })
        } else {
          if (command === 'lock') {
            //Prevent a User from using a command
            if (!denyList || Object.keys(denyList).indexOf(subCommand) === -1) {
              denyList[subCommand] = [];
            } else if (denyList[subCommand].indexOf(member.firstKey()) === -1) {
              denyList[subCommand].push(member.firstKey());
            }
          } else if (command === 'unlock') {
            //"Unban" user.
            let indexOfMember = denyList[subCommand].indexOf(member.firstKey());
            if (indexOfMember !== -1) {
              denyList[subCommand].splice(indexOfMember, 1);
            }
          }


        }
      }

    } else {
      evt.reply(`"${subCommand}" n'est pas une commande valide, admin.`).then(() => {
        reject("Command " + subcommand + " does not exist.");
        return;
      });
    }
    //Save the config file.
    saveConfig().then(() => {
      resolve();
    });


  });
}
/**
  Get member from an identifiable trait (id, username)
  @param members Array of all members
  @param trait to identify
  @return Member if found, false if not.
**/
let getMember = (members, ident) => {
  let chosenOne = members.filter((member) => {
    return member.user.username == ident || member.user.id == ident;
  });
  return chosenOne;
}

exports.default = {
  lock: lock,
  unlock: lock
}</code></pre>
        </article>
    </section>


</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
    <h3>Modules</h3>
    <ul>
        <li><a href="module-parseTextCommand.html">parseTextCommand</a></li>
    </ul>
    <h3>Classes</h3>
    <ul>
        <li><a href="Jukebox.html">Jukebox</a></li>
        <li><a href="JukeboxFanburstItem.html">JukeboxFanburstItem</a></li>
        <li><a href="JukeboxItem.html">JukeboxItem</a></li>
        <li><a href="JukeboxLocalItem.html">JukeboxLocalItem</a></li>
        <li><a href="JukeboxOpeningmoeItem.html">JukeboxOpeningmoeItem</a></li>
        <li><a href="JukeboxYoutubeItem.html">JukeboxYoutubeItem</a></li>
    </ul>
    <h3>Events</h3>
    <ul>
        <li><a href="Jukebox.html#event:QueueEmpty">QueueEmpty</a></li>
        <li><a href="JukeboxFanburstItem.html#event:end">end</a></li>
        <li><a href="JukeboxItem.html#event:end">end</a></li>
        <li><a href="JukeboxLocalItem.html#event:end">end</a></li>
        <li><a href="JukeboxOpeningmoeItem.html#event:end">end</a></li>
        <li><a href="JukeboxYoutubeItem.html#event:end">end</a></li>
    </ul>
    <h3>Global</h3>
    <ul>
        <li><a href="global.html#_supportedSources">_supportedSources</a></li>
        <li><a href="global.html#addToQueue">addToQueue</a></li>
        <li><a href="global.html#asker">asker</a></li>
        <li><a href="global.html#blindTest">blindTest</a></li>
        <li><a href="global.html#chooseOneItem">chooseOneItem</a></li>
        <li><a href="global.html#displayMessage">displayMessage</a></li>
        <li><a href="global.html#exitHandler">exitHandler</a></li>
        <li><a href="global.html">expiration</a></li>
        <li><a href="global.html#getMember">getMember</a></li>
        <li><a href="global.html#hasBegun">hasBegun</a></li>
        <li><a href="global.html#infos">infos</a></li>
        <li><a href="global.html#isBlindTest">isBlindTest</a></li>
        <li><a href="global.html#isPaused">isPaused</a></li>
        <li><a href="global.html#isPlaying">isPlaying</a></li>
        <li><a href="global.html#list">list</a></li>
        <li><a href="global.html">openingListUpdateDate</a></li>
        <li><a href="global.html#pause">pause</a></li>
        <li><a href="global.html#play">play</a></li>
        <li><a href="global.html#replyRandom">replyRandom</a></li>
        <li><a href="global.html#restart">restart</a></li>
        <li><a href="global.html#resume">resume</a></li>
        <li><a href="global.html#sandwich">sandwich</a></li>
        <li><a href="global.html#save">save</a></li>
        <li><a href="global.html#saveConfig">saveConfig</a></li>
        <li><a href="global.html#saveDatabaseConfig">saveDatabaseConfig</a></li>
        <li><a href="global.html#search">search</a></li>
        <li><a href="global.html#setVolume">setVolume</a></li>
        <li><a href="global.html#skip">skip</a></li>
        <li><a href="global.html#stop">stop</a></li>
        <li><a href="global.html#textChannel">textChannel</a></li>
        <li><a href="global.html#track">track</a></li>
        <li><a href="global.html#voiceConnection">voiceConnection</a></li>
        <li><a href="global.html#volume">volume</a></li>
        <li><a href="global.html#waitForMessage">waitForMessage</a></li>
        <li><a href="global.html#yesNoQuestion">yesNoQuestion</a></li>
    </ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jul 15 2018 14:20:18
    GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
