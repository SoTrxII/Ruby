<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: classes/JukeboxItem.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="styles/prettify-tomorrow.css" rel="stylesheet" type="text/css">
    <link href="styles/jsdoc-default.css" rel="stylesheet" type="text/css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: classes/JukeboxItem.js</h1>


    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const EventEmitter = require('events');
const {
    RichEmbed
} = require('discord.js');
const debug = require('debug')('jukeboxItem')

/**
 * @class
 * @extends EventEmitter
 */
class JukeboxItem extends EventEmitter {

    constructor(track, voiceConnection, asker) {

        super();

        if (this === JukeboxItem) {
            throw new Error("Cannot construct an Abstract class");
        }

        if (!track || !voiceConnection || !asker) {
            throw new Error(`The track, the voice connection, and the asker are all required : 
            got track : ${track} 
            voiceConnection : ${voiceConnection}
            asker : ${asker}`);
        }
        /**
         * @public
         * @member {Discord/Member} asker Who's asking for the song to be played
         */
        this.asker = asker;

        /**
         * @public
         * @member {String} track Track to be played
         */
        this.track = track;

        /**
         * @private
         * @member {Discord/voiceConnection} voiceConnection Discord voice Connection
         */
        this._voiceConnection = voiceConnection;

        /**
         * @public
         * @member {Boolean} hasBegun Has the playback begun at some point ?
         */
        this.hasBegun = false;

        /**
         * @public
         * @member {Boolean} isPaused Is the playback paused ?
         */
        this.isPaused = false;

        /**
         * @private
         * @member {Discord/StreamDispatcher} _dispatcher Song playback dispatcher
         */
        this._dispatcher = null;
    }
    /**
     * @public
     * @abstract
     * @summary Play the source
     */
    play(options) {
        if (this.constructor.name == 'JukeboxItem') {
            throw new Error("This method has to be implemented !")
        }
        this.hasBegun = true;
    }

    /**
     * @public
     * @summary Resume the playback of the song if possible
     * @returns {Boolean} True if playback was resumed, false otherwise
     */
    resume() {
        if (this._dispatcher &amp;&amp; this.hasBegun &amp;&amp; this.isPaused) {
            this._dispatcher.resume();
            this.isPaused = false;
            return true
        }
        return false;
    }

    /**
     * @public
     * @summary Pause the playback of the song if possible
     * @returns {Boolean} True if the playback was paused, false otherwise
     */
    pause() {
        debug(this.hasBegun)
        if (this._dispatcher &amp;&amp; this.hasBegun &amp;&amp; !this.isPaused) {
            this._dispatcher.pause();
            this.isPaused = true;
            return true;
        }
        return false;

    }

    /**
     * @public
     * @summary Stops the playback of the song if possible
     * @returns {Boolean} True if the playback was stopped
     */
    stop() {
        if (this._dispatcher &amp;&amp; this.hasBegun) {
            this._dispatcher.end();
            return true;
        }
        return false;
    }

    /**
     * @static
     * @async
     * @abstract
     * @public
     * @summary Search for item to playback
     * @param query Whatto search for
     * @param {Discord/VoiceConnection} voiceConnection voicechannel to play into
     * @param {Discord/Member} asker 
     * @param {Integer} [MAX_RESULTS=3]
     * @return {JukeboxItem[]}
     */
    static async search(query, voiceConnection, asker, MAX_RESULTS = 3) {
        throw new Error("This method has to be implemented");
    }


    /**
     * @public
     * @summary Change the playback volume
     * 
     */
    setVolume(volume) {
        this._dispatcher.setVolume(volume)
    }

    /**
     * @public
     * @summary Change the playback Log volume
     * 
     */
    setLogVolume(volume) {
        this._dispatcher.setVolumeLogarithmic(volume)
    }

    /**
     * @async
     * @private
     * @abstract
     * @summary Get playback informations
     * @description Try to get all possible infos about the current playback (such as author, length, title...)
     * @return {Object} data gathered
     */
    async _getInfo() {
        debug(this)
        throw new Error("This method has to be implemented !")
    }

    /**
     * @async
     * @public
     * @summary return a string containing the minimum info about the track
     * @return {String}
     */
    async toString() {
        const data = await this._getInfo();
        return `${data.title} - ${data.author}`
    }

    /**
     * @async 
     * @public
     * @summary return an embed corresponding to current playback
     * @returns {Discord/RichEmbed} embed
     */
    async toEmbed() {
        const data = await this._getInfo();
        const em = new RichEmbed();
        const DESC_LIMIT = 100

        //Song-dependant parameters
        em.setTitle(data.title || 'Inconnu');
        em.addField('Auteur', data.author || 'Inconnu')
        // 2048 -> desc limit in embed
        let description;
        if (data.description) {
            if (data.description.length > DESC_LIMIT - 1) {
                description = `${data.description.substring(0, DESC_LIMIT - 4 )}...`;
            } else {
                description = data.description;
            }
        }
        em.setDescription(description || 'Une grosse musique');
        em.setImage(data.image || '');
        em.setURL(data.url || '');

        //Item dependant parameters
        debug(this.constructor.name)
        switch (this.constructor.name) {
            case 'JukeboxYoutubeItem':
                em.setThumbnail("https://upload.wikimedia.org/wikipedia/commons/2/2c/Logo_youtube_ios.jpg");
                em.setColor('#E62A21');
                break;
            case 'JukeboxSpotifyItem':
                em.setThumbnail("https://d29fhpw069ctt2.cloudfront.net/icon/image/38714/preview.svg");
                em.setColor('#1ED760');
                break;
            case 'JukeboxFanburstItem':
                em.setThumbnail("https://son.gg/wp-content/themes/songg/assets/img/fanburst-icon.png")
                em.setColor('#090909');
                break;
            case 'JukeboxOpeningmoeItem':
                em.setThumbnail("https://res.cloudinary.com/teepublic/image/private/s--7npRdgKh--/t_Preview/b_rgb:484849,c_limit,f_jpg,h_630,q_90,w_630/v1483979138/production/designs/1083137_1.jpg")
                em.setColor('#FF69B4');
                break;
            default:
                break;
        }
        em.setAuthor(
            this.asker.username,
            this.asker.displayAvatarURL,
        );

        //Jukebox dependant parameters
        em.setFooter(`DJ Ruby ~~`, global.Rin.user.displayAvatarURL);
        em.setTimestamp();


        return em;
    }

}

module.exports = JukeboxItem;</code></pre>
        </article>
    </section>


</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
    <h3>Modules</h3>
    <ul>
        <li><a href="module-parseTextCommand.html">parseTextCommand</a></li>
    </ul>
    <h3>Classes</h3>
    <ul>
        <li><a href="Jukebox.html">Jukebox</a></li>
        <li><a href="JukeboxFanburstItem.html">JukeboxFanburstItem</a></li>
        <li><a href="JukeboxItem.html">JukeboxItem</a></li>
        <li><a href="JukeboxLocalItem.html">JukeboxLocalItem</a></li>
        <li><a href="JukeboxOpeningmoeItem.html">JukeboxOpeningmoeItem</a></li>
        <li><a href="JukeboxYoutubeItem.html">JukeboxYoutubeItem</a></li>
    </ul>
    <h3>Events</h3>
    <ul>
        <li><a href="Jukebox.html#event:QueueEmpty">QueueEmpty</a></li>
        <li><a href="JukeboxFanburstItem.html#event:end">end</a></li>
        <li><a href="JukeboxItem.html#event:end">end</a></li>
        <li><a href="JukeboxLocalItem.html#event:end">end</a></li>
        <li><a href="JukeboxOpeningmoeItem.html#event:end">end</a></li>
        <li><a href="JukeboxYoutubeItem.html#event:end">end</a></li>
    </ul>
    <h3>Global</h3>
    <ul>
        <li><a href="global.html#_supportedSources">_supportedSources</a></li>
        <li><a href="global.html#addToQueue">addToQueue</a></li>
        <li><a href="global.html#asker">asker</a></li>
        <li><a href="global.html#blindTest">blindTest</a></li>
        <li><a href="global.html#chooseOneItem">chooseOneItem</a></li>
        <li><a href="global.html#displayMessage">displayMessage</a></li>
        <li><a href="global.html#exitHandler">exitHandler</a></li>
        <li><a href="global.html">expiration</a></li>
        <li><a href="global.html#getMember">getMember</a></li>
        <li><a href="global.html#hasBegun">hasBegun</a></li>
        <li><a href="global.html#infos">infos</a></li>
        <li><a href="global.html#isBlindTest">isBlindTest</a></li>
        <li><a href="global.html#isPaused">isPaused</a></li>
        <li><a href="global.html#isPlaying">isPlaying</a></li>
        <li><a href="global.html#list">list</a></li>
        <li><a href="global.html">openingListUpdateDate</a></li>
        <li><a href="global.html#pause">pause</a></li>
        <li><a href="global.html#play">play</a></li>
        <li><a href="global.html#replyRandom">replyRandom</a></li>
        <li><a href="global.html#restart">restart</a></li>
        <li><a href="global.html#resume">resume</a></li>
        <li><a href="global.html#sandwich">sandwich</a></li>
        <li><a href="global.html#save">save</a></li>
        <li><a href="global.html#saveConfig">saveConfig</a></li>
        <li><a href="global.html#saveDatabaseConfig">saveDatabaseConfig</a></li>
        <li><a href="global.html#search">search</a></li>
        <li><a href="global.html#setVolume">setVolume</a></li>
        <li><a href="global.html#skip">skip</a></li>
        <li><a href="global.html#stop">stop</a></li>
        <li><a href="global.html#textChannel">textChannel</a></li>
        <li><a href="global.html#track">track</a></li>
        <li><a href="global.html#voiceConnection">voiceConnection</a></li>
        <li><a href="global.html#volume">volume</a></li>
        <li><a href="global.html#waitForMessage">waitForMessage</a></li>
        <li><a href="global.html#yesNoQuestion">yesNoQuestion</a></li>
    </ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jul 15 2018 14:20:18
    GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
