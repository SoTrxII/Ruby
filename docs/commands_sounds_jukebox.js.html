<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: commands/sounds/jukebox.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="styles/prettify-tomorrow.css" rel="stylesheet" type="text/css">
    <link href="styles/jsdoc-default.css" rel="stylesheet" type="text/css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: commands/sounds/jukebox.js</h1>


    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//External Libraries
const Promise = require('bluebird');
const {
  join
} = require("path");
const Jukebox = require(join(global.baseAppDir, 'classes', 'Jukebox.js'));

/**
 * @async
 * @public
 * @summary Add a music to play
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {String} cmdArg Music to add
 */
const addToQueue = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  if (!global.jukebox.addMusic(cmdArg, evt.author)) {
    evt.channel.send(`${cmdArg} n'est pas un lien valide, non ajouté à la liste de lecture`);
    return;
  }
  await evt.channel.send(`Chansons à venir :`);
  global.jukebox.displayQueue();

}

/**
 * @async
 * @public
 * @summary Starts the jukebox
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {String} cmdArg Ignored
 */
const play = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  if (global.jukebox.isPlaying) {
    evt.channel.send(`La lecture est déjà en cours !`);
    return;
  }

  if (!global.jukebox.play()) {
    evt.channel.send(`Il n'y a pas de chanson dans la liste de lecture !`)
    return;
  }


}

/**
 * @async
 * @public
 * @summary Starts the jukebox
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {String} cmdArg Ignored
 */
const stop = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  if (!global.jukebox.isPlaying) {
    evt.channel.send(`Il n'y a pas de musique en cours de lecture !`);
    return;
  }

  if (!global.jukebox.stop(false)) {
    evt.channel.send(`JE NE PEUX PAS ARRETER WAAA !!!1`)
    return;
  }


}

/**
 * @async
 * @public
 * @summary Starts the jukebox
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {String} cmdArg Ignored
 */
const blindTest = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  let categories = {};
  categories[global.jukebox.blindTestCategories.ANIME] = {
    "type" : "Opening"
  }
  console.log(categories)
  console.log(Object.keys(categories))
  global.jukebox.blindTest(10, categories);


}

/**
 * @async
 * @public
 * @summary Pauses the jukebox
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {String} cmdArg Ignored
 */
const pause = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  if (!global.jukebox.isPlaying) {
    evt.channel.send("C'est difficile de faire pause sans avoir commencé à jouer...");
    return;
  }

  global.jukebox.pause();
}

/**
 * @async
 * @public
 * @summary Resume the jukebox
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {String} cmdArg Ignored
 */
const resume = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  if (!global.jukebox.isPaused()) {
    evt.channel.send("C'est difficile de reprendre sans faire pause...");
    return;
  }

  global.jukebox.resume();
}

/**
 * @async
 * @public
 * @summary Displays playlist
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {String} cmdArg Ignored
 */
const list = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  global.jukebox.displayQueue();

}

/**
 * @summary Skip current song and starts next
 * @param {Discord/Message} evt Discord message Event
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {Integer} [cmdArg = 0] If specified, skip cmdArg song
 */
const skip = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);
  if (!parseInt(cmdArg)) {
    cmdArg = 0;
  }

  try {
    global.jukebox.skipTo(cmdArg);
  } catch (ex) {
    console.log(ex)
    evt.channel.send(`Impossible de passer ${cmdArg} chansons`);
  }


}
/**
 * @async
 * @public
 * @summary Change playback volume
 * @param {Discord/Message} evt Change the volume of the playback
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {Integer} cmdArg New volume
 */
const setVolume = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  if (!global.jukebox.setVolume(cmdArg)) {
    evt.channel.send("Volume invalide. Il doit être compris entre 0 et 100")
    return;
  }
}

/**
 * @async
 * @public
 * @summary Search
 for a music to play back
 * @param {Discord/Message} evt Change the volume of the playback
 * @param {String} command Discord command string (ex : play, add, list)
 * @param {Integer} cmdArg New volume
 */
const search = async (evt, command, cmdArg) => {
  await _updateJukebox(evt);

  await global.jukebox.search(cmdArg, evt);
}


/**
 * @async
 * @private
 * @summary Assert jukebox existence and update the textChannel it 's writing into
 * and the voicechannel it's streaming into
 * @param {Discord/Message} evt message event leading to this function
 */
const _updateJukebox = async (evt) => {

  const asker = evt.guild.members.get(evt.author.id);
  const voiceChannel = asker.voiceChannel;

  if (!voiceChannel) {
    evt.reply("Tu dois être dans un canal vocal pour pouvoir lancer une commande !")
    return;
  }
  //Join user voicechannel
  if (!global.voiceConnection || global.voiceConnection.id != voiceChannel.id) {
    global.voiceConnection = await voiceChannel.join()
  }

  if (!global.jukebox) {
    global.jukebox = new Jukebox(global.voiceConnection, evt.channel);
  }

  if (global.jukebox.textChannel.id != evt.channel.id) {
    global.jukebox.setTextChannel(evt.channel)
  }

}


exports.default = {
  play: play,
  musique: play,
  addMusic: addToQueue,
  am: addToQueue,
  ajouter: addToQueue,
  list: list,
  liste: list,
  pause: pause,
  resume: resume,
  reprendre: resume,
  volume: setVolume,
  skip: skip,
  passer: skip,
  search :search,
  s :search,
  q : search,
  son: setVolume,
  stop: stop,
  blindtest : blindTest

}

exports.help = {
  'ajouter': {
    parameters: "URL d'une vidéo Youtube",
    desc: "Ajoute une musique à la liste de lecture",
    aliases: "am"
  },
  'liste': {
    parameters: "",
    desc: "Affiche la liste de lecture",
    aliases: "list"
  },
  'play': {
    parameters: "",
    desc: "Balance la musique de la liste de lecture",
    aliases: "musique"
  },
  'pause': {
    parameters: "",
    desc: "Met en pause la lecture de la musique en cours"
  },
  'reprendre': {
    parameters: "",
    desc: "Reprends la lecture après une pause",
    aliases: "resume"
  },
  'passer': {
    parameters: "",
    desc: "Arrête la chanson en cours et passe à la suivante",
    aliases: "skip"
  },
  'son': {
    parameters: "Entier entre 0 et 100",
    desc: "Change le volume de la lecture",
    aliases: "volume"
  },
  'search': {
    parameters: "Quoi chercher",
    desc: "Cherche sur les sources supportées une musique",
    aliases: ["s", "q" ]
  },
  'stop': {
    parameters: "",
    desc: "Arrête la lecture",
    aliases: "volume"
  },
};</code></pre>
        </article>
    </section>


</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
    <h3>Modules</h3>
    <ul>
        <li><a href="module-parseTextCommand.html">parseTextCommand</a></li>
    </ul>
    <h3>Classes</h3>
    <ul>
        <li><a href="Jukebox.html">Jukebox</a></li>
        <li><a href="JukeboxFanburstItem.html">JukeboxFanburstItem</a></li>
        <li><a href="JukeboxItem.html">JukeboxItem</a></li>
        <li><a href="JukeboxLocalItem.html">JukeboxLocalItem</a></li>
        <li><a href="JukeboxOpeningmoeItem.html">JukeboxOpeningmoeItem</a></li>
        <li><a href="JukeboxYoutubeItem.html">JukeboxYoutubeItem</a></li>
    </ul>
    <h3>Events</h3>
    <ul>
        <li><a href="Jukebox.html#event:QueueEmpty">QueueEmpty</a></li>
        <li><a href="JukeboxFanburstItem.html#event:end">end</a></li>
        <li><a href="JukeboxItem.html#event:end">end</a></li>
        <li><a href="JukeboxLocalItem.html#event:end">end</a></li>
        <li><a href="JukeboxOpeningmoeItem.html#event:end">end</a></li>
        <li><a href="JukeboxYoutubeItem.html#event:end">end</a></li>
    </ul>
    <h3>Global</h3>
    <ul>
        <li><a href="global.html#_supportedSources">_supportedSources</a></li>
        <li><a href="global.html#addToQueue">addToQueue</a></li>
        <li><a href="global.html#asker">asker</a></li>
        <li><a href="global.html#blindTest">blindTest</a></li>
        <li><a href="global.html#chooseOneItem">chooseOneItem</a></li>
        <li><a href="global.html#displayMessage">displayMessage</a></li>
        <li><a href="global.html#exitHandler">exitHandler</a></li>
        <li><a href="global.html">expiration</a></li>
        <li><a href="global.html#getMember">getMember</a></li>
        <li><a href="global.html#hasBegun">hasBegun</a></li>
        <li><a href="global.html#infos">infos</a></li>
        <li><a href="global.html#isBlindTest">isBlindTest</a></li>
        <li><a href="global.html#isPaused">isPaused</a></li>
        <li><a href="global.html#isPlaying">isPlaying</a></li>
        <li><a href="global.html#list">list</a></li>
        <li><a href="global.html">openingListUpdateDate</a></li>
        <li><a href="global.html#pause">pause</a></li>
        <li><a href="global.html#play">play</a></li>
        <li><a href="global.html#replyRandom">replyRandom</a></li>
        <li><a href="global.html#restart">restart</a></li>
        <li><a href="global.html#resume">resume</a></li>
        <li><a href="global.html#sandwich">sandwich</a></li>
        <li><a href="global.html#save">save</a></li>
        <li><a href="global.html#saveConfig">saveConfig</a></li>
        <li><a href="global.html#saveDatabaseConfig">saveDatabaseConfig</a></li>
        <li><a href="global.html#search">search</a></li>
        <li><a href="global.html#setVolume">setVolume</a></li>
        <li><a href="global.html#skip">skip</a></li>
        <li><a href="global.html#stop">stop</a></li>
        <li><a href="global.html#textChannel">textChannel</a></li>
        <li><a href="global.html#track">track</a></li>
        <li><a href="global.html#voiceConnection">voiceConnection</a></li>
        <li><a href="global.html#volume">volume</a></li>
        <li><a href="global.html#waitForMessage">waitForMessage</a></li>
        <li><a href="global.html#yesNoQuestion">yesNoQuestion</a></li>
    </ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jul 15 2018 14:20:18
    GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
